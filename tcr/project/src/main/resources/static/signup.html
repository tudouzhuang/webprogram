<!DOCTYPE html>
<html lang="en"> 
<head>
    <title>注册</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portal - Bootstrap 5 Admin Dashboard Template For Developers">
    <meta name="author" content="Xiaoying Riley at 3rd Wave Media">    
    <link rel="shortcut icon" href="favicon.ico">
    <script defer src="assets/plugins/fontawesome/js/all.min.js"></script>
    <link id="theme-style" rel="stylesheet" href="assets/css/portal.css">

</head>
<body class="app app-signup p-0">    	
    <div class="row g-0 app-auth-wrapper">
	    <div class="col-12 col-md-7 col-lg-6 auth-main-col text-center p-5">
		    <div class="d-flex flex-column align-content-end">
			    <div class="app-auth-body mx-auto">	
				    <div class="app-auth-branding mb-4"><a class="app-logo" href="index.html"><img class="logo-icon me-2" src="assets/images/app-logo.svg" alt="logo"></a></div>
					<h2 class="auth-heading text-center mb-4">注 册</h2>
	
					<div class="auth-form-container text-start mx-auto">
						<form class="auth-form auth-signup-form">         
							<div class="email mb-3">
								<label class="sr-only" for="signup-email">你的名字</label>
								<input id="signup-name" name="signup-name" type="text" class="form-control signup-name" placeholder="请输入您的用户名" required="required">
							</div>
							<div class="email mb-3">
								<label class="sr-only" for="signup-email">你的邮件</label>
								<input id="signup-email" name="signup-email" type="email" class="form-control signup-email" placeholder="请输入您的邮件" required="required">
							</div>
							<div class="password mb-3">
								<label class="sr-only" for="signup-password">密码</label>
								<input id="signup-password" name="signup-password" type="password" class="form-control signup-password" placeholder="请输入您的密码" required="required">
							</div>
							<div class="mb-3">
								<label class="sr-only" for="identity-select">身份</label>
								<select id="identity-select" name="identity" class="form-control">
									<option value="student">我是学生</option>
									<option value="teacher">我是老师</option>
								</select>
							</div>
							<div class="extra mb-3">
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="" id="RememberPassword">
									<label class="form-check-label" for="RememberPassword">
									我同意遵守<a href="#" class="app-link">用户协议</a> 和 <a href="#" class="app-link">法律规范</a>.
									</label>
								</div>
							</div>
							<div class="text-center">
								<button type="submit" class="btn app-btn-primary w-100 theme-btn mx-auto">注册</button>
							</div>
						</form>
						
						<div class="auth-option text-center pt-5">已经有了账户？ <a class="text-link" href="login.html" >登录</a></div>
					</div>
			    </div>
		    </div>
	    </div>
	    <div class="col-12 col-md-5 col-lg-6 h-100 auth-background-col">
		    <div class="auth-background-holder">			    
		    </div>
		    <div class="auth-background-mask"></div>
		    <div class="auth-background-overlay p-3 p-lg-5">
			    <div class="d-flex flex-column align-content-end h-100">
				    <div class="h-100"></div>
				</div>
		    </div>
	    </div>
    </div>

    <!-- 引入 Axios 库，用于发送网络请求 -->
    <script src="material/axios.min.js"></script>

	<script>
        // 1. 首先，通过类名找到我们的注册表单元素
        const signupForm = document.querySelector('.auth-signup-form');

        // 2. 给这个表单添加一个 "submit" (提交) 事件的监听器
        signupForm.addEventListener('submit', function(event) {
            
            // 3. 阻止表单的默认提交行为，这是为了防止页面自己刷新
            event.preventDefault(); 
            
            // 4. 从各个输入框中，通过它们的 ID 获取用户输入的值
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const identity = document.getElementById('identity-select').value;
            
            // 5. 进行简单的非空验证
            if (!name || !email || !password) {
                alert('用户名、邮箱和密码不能为空！');
                return; // 如果有空项，就停止执行
            }

            // 6. 将收集到的数据打包成一个 JavaScript 对象
            //    注意：这里的键名 (name, email, password, identity)
            //    必须和你后端 UserRegisterDTO.java 类中的字段名完全一致！
            const formData = {
                name: name,
                email: email,
                password: password,
                identity: identity
            };

            // 7. 使用 Axios 发送一个 POST 请求到后端的注册接口
            //    请求地址是 '/api/users/register'
            //    请求体是 我们刚刚打包好的 formData
            axios.post('/api/users/register', formData)
                .then(function (response) {
                    // 8a. 如果请求成功了 (后端返回了 2xx 状态码)，就会执行这里的代码
                    console.log('后端成功响应:', response.data);
                    alert('恭喜你，注册成功！现在将跳转到登录页面。');
                    // 1秒后自动跳转到登录页
                    setTimeout(function() {
                        window.location.href = 'login.html'; 
                    }, 1000);
                })
                .catch(function (error) {
                    // 8b. 如果请求失败了 (后端返回了 4xx 或 5xx 状态码)，就会执行这里的代码
                    console.error('注册请求失败:', error);
                    
                    // 尝试从后端的响应中获取具体的错误信息来提示用户
                    let errorMessage = '注册失败，请稍后再试。';
                    if (error.response && error.response.data) {
                        // 比如，后端返回了 "用户名已存在"
                        errorMessage = error.response.data;
                    }
                    
                    alert(errorMessage);
                });
        });
    </script>
    <!-- ↑↑↑ 复制并粘贴到这里结束 ↑↑↑ -->





</body>
</html> 

