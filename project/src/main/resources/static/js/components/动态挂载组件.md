动态挂载组件

# 前端核心组件功能剖析 (`/js/components/`)

本文档旨在详细解析项目前端的核心Vue组件，阐明每个组件的职责、功能以及它们在整体业务流程中的位置。所有组件均以传统方式定义（`Vue.component(...)`）并通过动态挂载（`<component :is="...">`）实现页面切换。

---

### **1. 核心业务流程组件**

这些组件直接服务于项目的核心工作流：**设计 -> 提交 -> 审核 -> 归档**。

#### `process-record-panel.js`
- **页面名称**: **设计过程记录表 - 创建/编辑页**
- **核心功能**: 这是**设计人员**的核心工作界面。它提供了一个完整的表单，用于创建或编辑一份《设计过程记录表》。
- **详细职责**:
  - 填写零件名、工序名等基本信息。
  - 填写材质、尺寸、重量等所有详细规格参数。
  - 提供一个清单，让设计人员可以勾选本次设计需要包含的检查项 (Sheets)。
  - **关键操作**: 包含一个文件上传控件，允许设计人员上传包含所有勾选Sheet内容的完整Excel源文件。
  - **触发流程**: 提交后，后端会将此记录的状态设置为 `PENDING_REVIEW` (待审核)，并发起审核流程。

#### `record-review-panel.js`
- **页面名称**: **在线审核与批注页 (核心)**
- **核心功能**: 这是**审核人员**的核心工作界面，也是整个项目的技术亮点。当审核人员从任务列表点击“开始审核”后，就会进入此页面。
- **详细职责**:
  - **左右分栏布局**:
    - **左侧 (只读)**: 使用 `iframe + Luckysheet` 高保真地预览设计人员提交的原始Excel文件内容，不可编辑。
    - **右侧 (可编辑)**: 使用另一个 `iframe + Luckysheet` 加载审核模板。审核人员可在此区域填写审核意见、打勾、插入批注图片等。
  - **图片处理**: 拦截用户插入的图片，先上传至后端获取URL，再将URL回填到Luckysheet中，解决了图片离线保存的问题。
  - **关键操作**: “保存审核结果”按钮。点击后，前端会将右侧Luckysheet的完整数据（包含图片URL）生成为 `.xlsx` 文件并发送到后端，后端完成审核结果的归档，并将记录状态更新为 `APPROVED` (已批准)。

#### `review-tasks-panel.js`
- **页面名称**: **项目审查任务列表页**
- **核心功能**: 这是**审核人员**登录后看到的主要任务仪表盘。它展示了特定项目下所有需要他处理或已处理的审核任务。
- **详细职责**:
  - 以表格形式列出所有相关的《设计过程记录表》。
  - 根据记录的状态（如 `PENDING_REVIEW`, `APPROVED`, `CHANGES_REQUESTED`）显示不同的标签颜色和操作按钮。
  - **关键操作**:
    - **开始审核**: 对于“待审核”的任务，点击后会切换到 `record-review-panel` 页面。
    - **打回修改**: 对于“已批准”的任务，点击后弹出对话框，填写原因后将任务状态变为 `CHANGES_REQUESTED` 并退回给设计员。
    - **转交**: 对于“待审核”的任务，点击后弹出对话框，可将任务分配给其他审核员。

#### `process-record-list-panel.js`
- **页面名称**: **我的设计记录列表页**
- **核心功能**: 这是**设计人员**的任务列表和跟踪页面，功能与 `review-tasks-panel.js` 对应。
- **详细职责**:
  - 展示当前登录的设计人员在特定项目下创建的所有《设计过程记录表》。
  - 同样根据状态显示进度，如 `DRAFT` (草稿), `PENDING_REVIEW` (审核中), `CHANGES_REQUESTED` (被打回), `APPROVED` (已通过)。
  - **关键操作**:
    - **编辑/提交**: 对于“草稿”状态的记录。
    - **修改后重提**: 对于“被打回”状态的记录。
    - **查看详情**: 对于已提交或已完成的记录。

---

### **2. 项目管理与设置组件**

这些组件负责项目的创建和宏观管理。

#### `create-project-panel.js`
- **页面名称**: **项目创建页**
- **核心功能**: 提供一个极简的界面，让授权用户（如设计员、项目经理）快速创建一个新项目。
- **详细职责**:
  - 通常只包含一个输入框，用于填写唯一的项目名称（如 "ST8项目"）。
  - 点击创建后，后端会在 `projects` 表中生成一条新记录。

#### `project-details-panel.js`
- **页面名称**: **项目详情主面板**
- **核心功能**: 这是一个容器或仪表盘页面，作为进入具体项目后的主视图。
- **详细职责**:
  - 显示项目的基本信息。
  - **关键作用**: 通常包含多个标签页或按钮，用于在不同的项目子页面之间切换，例如 "设计记录列表" (`process-record-list-panel`) 和 "审查任务列表" (`review-tasks-panel`)。

#### `project-planning-panel.js`
- **页面名称**: **设计策划书管理页**
- **核心功能**: 专用于**技术经理**上传和管理项目的《设计策划书》。
- **详细职责**:
  - 提供一个文件上传入口，允许技术经理上传作为项目总纲的多Sheet Excel文件。
  - 提供预览或下载功能，让所有项目成员（设计、审核）可以只读查看这份总纲文件。
  - 可能包含版本历史记录。

---

### **3. 通用与辅助组件**

这些组件被多个页面复用，或提供通用功能。

#### `dashboard-panel.js`
- **页面名称**: **系统总览仪表盘**
- **核心功能**: 用户登录后看到的第一个页面，提供一个全局的、跨项目的视图。
- **详细职责**:
  - 可能以卡片、图表等形式展示统计信息，如“我的待办任务总数”、“进行中的项目数量”等。
  - 提供快速入口，链接到各个具体项目中。

#### `user-dropdown.js`
- **页面名称**: **用户下拉菜单 (UI片段)**
- **核心功能**: 通常位于应用顶部的导航栏，显示当前登录用户的头像和名称。
- **详细职责**:
  - 点击后展开一个下拉菜单。
  - 提供“个人中心”、“修改密码”、“退出登录”等常用操作的链接。

#### `luckysheet-viewer.js` & `record-workspace-panel.js`
- **页面名称**: **通用文件/记录查看器**
- **核心功能**: 这两个可能是为了提供一个通用的只读预览功能而设计的。
- **详细职责**:
  - `luckysheet-viewer.js`: 一个专门用于只读预览Excel文件的组件，可能被 `project-planning-panel` 或其他需要展示Excel的地方复用。
  - `record-workspace-panel.js`: 一个通用的、用于展示已完成或已归档的《设计过程记录表》及其审核结果的只读详情页。

#### `craft-planning-panel.js`
- **页面名称**: **工艺策划面板 (推测)**
- **核心功能**: 从命名推测，这可能是一个与《设计策划书》并列的、用于管理**工艺**相关文档或数据的面板。
- **详细职责**:
  - 类似于 `project-planning-panel`，可能用于上传、管理和查阅工艺卡、工艺流程图等文件。
  - 具体功能取决于项目的业务深度。